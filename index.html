<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒœãƒˆãƒ«ç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    input, button, textarea { padding: 8px; margin: 5px; }
    input, button, textarea {
      font-size: 16px;
    }
    .entry { background: white; padding: 10px; margin: 5px 0; border-radius: 5px; }
    .delete-btn { color: red; cursor: pointer; margin-left: 10px; }
    textarea { vertical-align: middle; resize: vertical; }

    .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: #ccc; }
    .tab-btn.active { background: #666; color: white; }

    .section { display: none; }
    .section.active { display: block; margin-top: 20px; }

    @media (max-width: 600px) {
      input, button, textarea {
        width: 100%;
        box-sizing: border-box;
        margin: 8px 0;
      }

      .tab-btn {
        width: 50%;
        font-size: 16px;
      }

      .entry {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>ãƒœãƒˆãƒ«ç®¡ç†</h1>

  <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
  <div>
    <button class="tab-btn active" onclick="showSection('search')">ğŸ” æ¤œç´¢</button>
    <button class="tab-btn" onclick="showSection('register')">ğŸ“ ç™»éŒ²</button>
  </div>

  <!-- æ¤œç´¢ç”»é¢ -->
  <div id="search" class="section active">
    <h3>ãŠå®¢æ§˜ã§æ¤œç´¢</h3>
    <input type="text" id="searchInput" placeholder="åå‰ã§æ¤œç´¢" oninput="loadEntries()">
    <h2>ä¸€è¦§</h2>
    <div id="list"></div>
  </div>

  <!-- ç™»éŒ²ç”»é¢ -->
  <div id="register" class="section">
    <h3>æ–°è¦ç™»éŒ²</h3>
    <input type="text" id="name" placeholder="ãŠå®¢æ§˜ã®åå‰"><br>
    <input type="text" id="bottle" placeholder="ãƒœãƒˆãƒ«å"><br>
    <input type="text" id="account" placeholder="å£åº§"><br>
    <textarea id="note" placeholder="å‚™è€ƒ" rows="2" cols="40"></textarea><br>
    <button onclick="addEntry()">ç™»éŒ²</button>
  </div>

  <script>
    const listDiv = document.getElementById("list");
    let editStates = [];

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');

      if (id === "search") {
        loadEntries();
      }
    }

    function loadEntries() {
      listDiv.innerHTML = "";
      const search = document.getElementById("searchInput")?.value.toLowerCase() || "";
      const entries = JSON.parse(localStorage.getItem("bottles") || "[]");

      entries.forEach((entry, index) => {
        if (!entry.name.toLowerCase().includes(search)) return;

        const isEditing = editStates[index] || false;
        const div = document.createElement("div");
        div.className = "entry";

        if (isEditing) {
          div.innerHTML = `
            åå‰: <input type="text" id="nameInput-${index}" value="${entry.name}"><br>
            ãƒœãƒˆãƒ«å: <input type="text" id="bottleInput-${index}" value="${entry.bottle}"><br>
            å£åº§: <input type="text" id="accountInput-${index}" value="${entry.account || ''}" placeholder="ãªã—"><br>
            å‚™è€ƒ: <input type="text" id="noteInput-${index}" value="${entry.note || ''}" placeholder="ãªã—"><br>
            æœ€çµ‚æ¥åº—æ—¥: ${entry.visitDate || 'æœªè¨˜å…¥'}
            <input type="date" id="visitInput-${index}">
            <button onclick="submitAllUpdates(${index})">ä¿å­˜</button>
          `;
        } else {
          div.innerHTML = `
            åå‰: ${entry.name}<br>
            ãƒœãƒˆãƒ«å: ${entry.bottle}<br>
            å£åº§: ${entry.account || 'ãªã—'}<br>
            å‚™è€ƒ: ${entry.note || 'ãªã—'}<br>
            æœ€çµ‚æ¥åº—æ—¥: ${entry.visitDate || 'æœªè¨˜å…¥'}
            <button onclick="toggleEdit(${index})" style="float:right;">ç·¨é›†</button>
          `;
        }

        const del = document.createElement("span");
        del.textContent = "å‰Šé™¤";
        del.className = "delete-btn";
        del.onclick = () => deleteEntry(index);
        div.appendChild(del);
        listDiv.appendChild(div);
      });
    }

    function toggleEdit(index) {
      editStates[index] = true;
      loadEntries();
    }

    function submitAllUpdates(index) {
      const entries = JSON.parse(localStorage.getItem("bottles") || "[]");

      const name = document.getElementById(`nameInput-${index}`).value.trim();
      const bottle = document.getElementById(`bottleInput-${index}`).value.trim();
      const account = document.getElementById(`accountInput-${index}`).value.trim();
      const note = document.getElementById(`noteInput-${index}`).value.trim();
      const visitDate = document.getElementById(`visitInput-${index}`).value;

      if (!name || !bottle) return alert("åå‰ã¨ãƒœãƒˆãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

      entries[index] = { name, bottle, account, note, visitDate };
      localStorage.setItem("bottles", JSON.stringify(entries));
      editStates[index] = false;
      loadEntries();
    }

    function addEntry() {
      const name = document.getElementById("name").value.trim();
      const bottle = document.getElementById("bottle").value.trim();
      const account = document.getElementById("account").value.trim();
      const note = document.getElementById("note").value.trim();
      const visitDate = ""; // initialize as empty string

      if (!name || !bottle) return alert("åå‰ã¨ãƒœãƒˆãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

      const entries = JSON.parse(localStorage.getItem("bottles") || "[]");
      entries.push({ name, bottle, account, note, visitDate });
      localStorage.setItem("bottles", JSON.stringify(entries));

      document.getElementById("name").value = "";
      document.getElementById("bottle").value = "";
      document.getElementById("account").value = "";
      document.getElementById("note").value = "";

      showSection("search");
      loadEntries();
    }

    function deleteEntry(index) {
      if (!confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      const entries = JSON.parse(localStorage.getItem("bottles") || "[]");
      entries.splice(index, 1);
      localStorage.setItem("bottles", JSON.stringify(entries));
      loadEntries();
    }

    // åˆæœŸè¡¨ç¤º
    loadEntries();
  </script>
</body>
</html>