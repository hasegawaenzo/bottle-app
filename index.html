<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ボトル管理（共有版）</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDAHavEv8va5f9W-6Tl7UGwLs_27-Vm7yU",
      authDomain: "bottle-app-ad02e.firebaseapp.com",
      projectId: "bottle-app-ad02e",
      storageBucket: "bottle-app-ad02e.firebasestorage.app",
      messagingSenderId: "92055103267",
      appId: "1:92055103267:web:4bff00001bd81dee9d0e96"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "bottles");

    const nameInput = document.getElementById("name");
    const bottleInput = document.getElementById("bottle");
    const noteInput = document.getElementById("note");
    const visitInput = document.getElementById("visitDate");
    const listDiv = document.getElementById("list");

    async function addEntry() {
      const name = nameInput.value.trim();
      const bottle = bottleInput.value.trim();
      const note = noteInput.value.trim();
      const visitDate = visitInput.value;
      if (!name || !bottle) return alert("名前とボトル名を入力してください");
      await addDoc(colRef, { name, bottle, note, visitDate });
      nameInput.value = "";
      bottleInput.value = "";
      noteInput.value = "";
      visitInput.value = "";
    }

    function renderEntry(docData, id) {
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `
        <strong>${docData.name}</strong><br>
        ボトル名: ${docData.bottle}<br>
        備考: ${docData.note || "なし"}<br>
        最終来店日: ${docData.visitDate || "未記入"}<br>
        <button onclick="deleteEntry('${id}')">削除</button>
      `;
      listDiv.appendChild(div);
    }

    function loadEntries() {
      listDiv.innerHTML = "";
      onSnapshot(colRef, snapshot => {
        listDiv.innerHTML = "";
        snapshot.forEach(doc => {
          renderEntry(doc.data(), doc.id);
        });
      });
    }

    window.deleteEntry = async function (id) {
      await deleteDoc(doc(db, "bottles", id));
    };

    document.getElementById("addBtn").onclick = addEntry;
    loadEntries();
  </script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    input, textarea, button { margin: 5px 0; padding: 8px; width: 100%; }
    .entry { background: white; margin: 10px 0; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>ボトル管理（共有版）</h1>
  <input type="text" id="name" placeholder="お客様の名前" />
  <input type="text" id="bottle" placeholder="ボトル名" />
  <textarea id="note" placeholder="備考"></textarea>
  <input type="date" id="visitDate" />
  <button id="addBtn">登録</button>
  <h2>一覧</h2>
  <div id="list"></div>
</body>
</html>